tmux new-session -d -s standalone -n standalone || true
tmux new-window -n deploy -t 0 || true
tmux new-window -n glances -t 1 || true
tmux select-window -t 0
{% if False in (developer_patches | map(attribute='install_in_venv') | list) %}
tmux send-keys "/opt/tripleo/build-packages.sh" C-m
{% endif %}
{% if True in (developer_patches | map(attribute='install_in_venv') | list) %}
tmux send-keys "source /opt/tripleo-patches/bin/activate" C-m
{% endif %}
tmux send-keys "openstack tripleo container image prepare default --output-env-file containers-prepare-parameter.yaml" C-m
{% set environments = ['/usr/share/openstack-tripleo-heat-templates/environments/enable-swap.yaml'] %}
{% set _ = environments.append('/usr/share/openstack-tripleo-heat-templates/environments/standalone/standalone-tripleo.yaml') %}
{% set _ = environments.append(ansible_env.HOME ~ '/containers-prepare-parameter.yaml') %}
{% set _ = environments.append(ansible_env.HOME ~ '/standalone_parameters.yaml') %}
tmux send-keys "sudo --preserve-env=PATH,VIRTUAL_ENV openstack tripleo deploy  \
                --templates /usr/share/openstack-tripleo-heat-templates \
                --local-ip={{ tripleo_job_address }}/{{ tripleo_cidr | ipaddr('prefix') }} \
                -r /usr/share/openstack-tripleo-heat-templates/roles/Standalone.yaml \
                -e {{ environments | join(' -e ') }} {{ (tripleo_ceph_enabled | bool) | ternary(tripleo_ceph_standalone_templates, '') }} \
                --output-dir {{ ansible_env.HOME }} \
                --standalone" C-m
tmux select-window -t 1
tmux send-keys "/opt/rdo/bin/glances --disable-autodiscover --diskio-iops --diskio-show-ramfs --enable-irq" C-m
tmux select-window -t 0

echo -e "Stack creation has been initiated."
